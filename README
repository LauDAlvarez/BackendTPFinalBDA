# 游닄 Documentaci칩n de API - Dashboard de Ventas

## 游댏 Autenticaci칩n

### 1. Login
**Endpoint:** `POST /api/auth/login`

**Body:**
```json
{
  "usuario": "admin",
  "contrase침a": "admin123"
}
```

**Respuesta exitosa (200):**
```json
{
  "success": true,
  "message": "Login exitoso",
  "user": {
    "id": 1,
    "usuario": "admin",
    "mail": "admin@dashboard.com",
    "fechaCreacion": "2025-10-08T12:00:00.000Z"
  }
}
```

**Respuesta error (401):**
```json
{
  "success": false,
  "message": "Usuario o contrase침a incorrectos"
}
```

---

### 2. Register
**Endpoint:** `POST /api/auth/register`

**Body:**
```json
{
  "usuario": "nuevo_usuario",
  "contrase침a": "password123",
  "mail": "usuario@email.com"
}
```

**Respuesta exitosa (201):**
```json
{
  "success": true,
  "message": "Usuario registrado exitosamente",
  "user": {
    "id": 5,
    "usuario": "nuevo_usuario",
    "mail": "usuario@email.com"
  }
}
```

**Respuestas de error:**
- **409:** Usuario o email ya registrado
- **400:** Datos faltantes o formato inv치lido

---

## 游논 Gesti칩n de Usuarios

### 3. Obtener Todos los Usuarios
**Endpoint:** `GET /api/users`

**Respuesta exitosa (200):**
```json
{
  "success": true,
  "message": "Usuarios obtenidos exitosamente",
  "count": 4,
  "users": [
    {
      "id": 1,
      "usuario": "admin",
      "mail": "admin@dashboard.com",
      "fechaCreacion": "2025-10-08T12:00:00.000Z"
    },
    {
      "id": 2,
      "usuario": "gerente_centro",
      "mail": "centro@dashboard.com",
      "fechaCreacion": "2025-10-08T13:00:00.000Z"
    }
  ]
}
```

**Ejemplo de uso con curl:**
```bash
curl http://localhost:3001/api/users
```

**Ejemplo con JavaScript/Axios:**
```javascript
const response = await axios.get('http://localhost:3001/api/users');
console.log(response.data.users);
```

---

### 4. Obtener Usuario por ID
**Endpoint:** `GET /api/users/:id`

**Par치metros:**
- `id` (number) - ID del usuario

**Ejemplo:** `GET /api/users/1`

**Respuesta exitosa (200):**
```json
{
  "success": true,
  "message": "Usuario obtenido exitosamente",
  "user": {
    "id": 1,
    "usuario": "admin",
    "mail": "admin@dashboard.com",
    "fechaCreacion": "2025-10-08T12:00:00.000Z"
  }
}
```

**Respuesta error (404):**
```json
{
  "success": false,
  "message": "Usuario no encontrado"
}
```

---

### 5. Buscar Usuarios
**Endpoint:** `GET /api/users/search?search=termino`

**Query Parameters:**
- `search` (string) - T칠rmino de b칰squeda (busca en usuario y email)

**Ejemplo:** `GET /api/users/search?search=admin`

**Respuesta exitosa (200):**
```json
{
  "success": true,
  "message": "B칰squeda completada",
  "count": 1,
  "users": [
    {
      "id": 1,
      "usuario": "admin",
      "mail": "admin@dashboard.com",
      "fechaCreacion": "2025-10-08T12:00:00.000Z"
    }
  ]
}
```

**Ejemplo de uso:**
```bash
curl "http://localhost:3001/api/users/search?search=admin"
```

---

### 6. Obtener Estad칤sticas
**Endpoint:** `GET /api/users/stats`

**Respuesta exitosa (200):**
```json
{
  "success": true,
  "message": "Estad칤sticas obtenidas exitosamente",
  "stats": {
    "totalUsuarios": 6,
    "nuevosUltimaSemana": 2,
    "nuevosUltimoMes": 4
  }
}
```

---

### 7. Actualizar Usuario
**Endpoint:** `PUT /api/users/:id`

**Par치metros:**
- `id` (number) - ID del usuario a actualizar

**Body (todos los campos son opcionales, pero al menos uno es requerido):**
```json
{
  "usuario": "nuevo_nombre_usuario",
  "mail": "nuevo@email.com"
}
```

**Respuesta exitosa (200):**
```json
{
  "success": true,
  "message": "Usuario actualizado exitosamente",
  "user": {
    "id": 5,
    "usuario": "nuevo_nombre_usuario",
    "mail": "nuevo@email.com",
    "fechaCreacion": "2025-10-08T14:00:00.000Z"
  }
}
```

**Respuestas de error:**
- **404:** Usuario no encontrado
- **409:** Usuario o email ya en uso
- **400:** Datos inv치lidos

**Ejemplo con curl:**
```bash
curl -X PUT http://localhost:3001/api/users/5 \
  -H "Content-Type: application/json" \
  -d '{"mail":"nuevo@email.com"}'
```

---

### 8. Cambiar Contrase침a
**Endpoint:** `PUT /api/users/:id/password`

**Par치metros:**
- `id` (number) - ID del usuario

**Body:**
```json
{
  "contrase침aActual": "password123",
  "contrase침aNueva": "newpassword456"
}
```

**Respuesta exitosa (200):**
```json
{
  "success": true,
  "message": "Contrase침a cambiada exitosamente"
}
```

**Respuestas de error:**
- **401:** Contrase침a actual incorrecta
- **400:** Nueva contrase침a muy corta (m칤nimo 8 caracteres)

---

### 9. Eliminar Usuario
**Endpoint:** `DELETE /api/users/:id`

**Par치metros:**
- `id` (number) - ID del usuario a eliminar

**丘멆잺 Restricci칩n:** No se puede eliminar el usuario admin (ID 1)

**Respuesta exitosa (200):**
```json
{
  "success": true,
  "message": "Usuario eliminado exitosamente"
}
```

**Respuestas de error:**
- **404:** Usuario no encontrado
- **403:** No se puede eliminar el administrador

**Ejemplo con curl:**
```bash
curl -X DELETE http://localhost:3001/api/users/5
```

---

## 游늵 Resumen de Endpoints

| M칠todo | Endpoint | Descripci칩n |
|--------|----------|-------------|
| POST | `/api/auth/login` | Iniciar sesi칩n |
| POST | `/api/auth/register` | Registrar nuevo usuario |
| GET | `/api/users` | Obtener todos los usuarios |
| GET | `/api/users/:id` | Obtener usuario por ID |
| GET | `/api/users/search` | Buscar usuarios |
| GET | `/api/users/stats` | Estad칤sticas de usuarios |
| PUT | `/api/users/:id` | Actualizar usuario |
| PUT | `/api/users/:id/password` | Cambiar contrase침a |
| DELETE | `/api/users/:id` | Eliminar usuario |

---

## 游빍 Colecci칩n de Pruebas Postman

### Login
```http
POST http://localhost:3001/api/auth/login
Content-Type: application/json

{
  "usuario": "admin",
  "contrase침a": "admin123"
}
```

### Obtener Todos los Usuarios
```http
GET http://localhost:3001/api/users
```

### Buscar Usuario
```http
GET http://localhost:3001/api/users/search?search=admin
```

### Actualizar Usuario
```http
PUT http://localhost:3001/api/users/2
Content-Type: application/json

{
  "mail": "nuevo_email@example.com"
}
```

### Eliminar Usuario
```http
DELETE http://localhost:3001/api/users/5
```

---

## 游 C칩digos de Estado HTTP

| C칩digo | Significado |
|--------|-------------|
| 200 | OK - Petici칩n exitosa |
| 201 | Created - Recurso creado exitosamente |
| 400 | Bad Request - Datos inv치lidos |
| 401 | Unauthorized - Credenciales incorrectas |
| 403 | Forbidden - Acci칩n no permitida |
| 404 | Not Found - Recurso no encontrado |
| 409 | Conflict - Conflicto (ej: usuario duplicado) |
| 500 | Internal Server Error - Error del servidor |

---

## 游눠 Notas Importantes

1. **Seguridad:** Las contrase침as nunca se devuelven en las respuestas
2. **Formato de fechas:** ISO 8601 (YYYY-MM-DDTHH:mm:ss.sssZ)
3. **Encriptaci칩n:** Las contrase침as se almacenan en Base64
4. **Validaciones:** Todos los endpoints validan los datos de entrada
5. **Protecci칩n:** El usuario admin (ID 1) no puede ser eliminado

---

## 游댢 Ejemplos de Integraci칩n Frontend

### React/Next.js con Axios

```typescript
// Obtener todos los usuarios
const getUsers = async () => {
  const response = await axios.get('http://localhost:3001/api/users');
  return response.data.users;
};

// Buscar usuarios
const searchUsers = async (term: string) => {
  const response = await axios.get(`http://localhost:3001/api/users/search?search=${term}`);
  return response.data.users;
};

// Actualizar usuario
const updateUser = async (id: number, data: any) => {
  const response = await axios.put(`http://localhost:3001/api/users/${id}`, data);
  return response.data;
};

// Eliminar usuario
const deleteUser = async (id: number) => {
  const response = await axios.delete(`http://localhost:3001/api/users/${id}`);
  return response.data;
};
```